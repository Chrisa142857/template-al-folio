<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Extracting RoI BOLD signal of fMRI dataset by using CONN toolbox, using OASIS3 as an example | Ziquan Wei </title> <meta name="author" content="Ziquan Wei"> <meta name="description" content="fMRI data preprocessing"> <meta name="keywords" content="Ziquan, Wei, academic-website, Machine Learning, Medical Imaging, Neuroscience"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%98%80%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://ziquanw.com/blog/2023/conn-toolbox/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Ziquan</span> Wei </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Extracting RoI BOLD signal of fMRI dataset by using CONN toolbox, using OASIS3 as an example</h1> <p class="post-meta"> Created in May 24, 2023 </p> <p class="post-tags"> <a href="/blog/2023"> <i class="fa-solid fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/spm"> <i class="fa-solid fa-hashtag fa-sm"></i> SPM,</a>   <a href="/blog/tag/conn"> <i class="fa-solid fa-hashtag fa-sm"></i> CONN</a>   <a href="/blog/tag/toolbox"> <i class="fa-solid fa-hashtag fa-sm"></i> toolbox,</a>   <a href="/blog/tag/oasis"> <i class="fa-solid fa-hashtag fa-sm"></i> OASIS,</a>   <a href="/blog/tag/natlab"> <i class="fa-solid fa-hashtag fa-sm"></i> Natlab,</a>   <a href="/blog/tag/smri"> <i class="fa-solid fa-hashtag fa-sm"></i> sMRI,</a>   <a href="/blog/tag/fmri"> <i class="fa-solid fa-hashtag fa-sm"></i> fMRI</a>   ·   <a href="/blog/category/neuroscience"> <i class="fa-solid fa-tag fa-sm"></i> neuroscience</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>This blog is a hand-by-hand tutorial for researchers who in <a href="https://acmlab.org/" rel="external nofollow noopener" target="_blank">ACMLab</a> to process MRI data. In the meantime, make an effort for the development of the computational neuroimaging field.</p> <h2 id="0-install-software">0. Install Software</h2> <ul> <li>Matlab.</li> <li>CONN toolbox (Download .zip: link. Source page: link). Unzip it.</li> <li>SPM (Download .zip: link. Source page: link). Unzip it.</li> <li>Start Matlab, click on the ‘Set path’ button, then click on ‘Add folder’, and select your CONN installation folder (e.g. /software/conn). After this, click again on ‘Add folder’ and now select the SPM installation folder (e.g. /software/spm12). Click on ‘Save’ and ‘Close’ to save these changes for future Matlab sessions</li> </ul> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/post_conn_1-480.webp 480w,/assets/img/post_conn_1-800.webp 800w,/assets/img/post_conn_1-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/post_conn_1.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Screenshot: Set path in Matlab. </div> <ul> <li>Install python <ul> <li>Install a miniconda and python</li> <li>Create an environment. Activate it.</li> <li>Use <code class="language-plaintext highlighter-rouge">pip install nibabel numpy scipy</code> </li> </ul> </li> </ul> <h2 id="i-what-data-do-you-have-the-input">I. What data do you have: The input</h2> <p>Briefly, you need to collect all paths of the input T1w and fMRI volume, and remap the raw atlas label to 1~N with the corresponding label name in .txt file.</p> <p><strong>One input of CONN toolbox is termed as <code class="language-plaintext highlighter-rouge">Subject</code>. It has one T1w and multiple fMRI.</strong></p> <ol> <li>One T1-weighted (T1w) MRI volume (3D) for each subject. For each subject, one T1w volume is enough. You need to check the T1w you are collecting is in a valid format by reading the file header, like orientation and dimension. For example, OASIS3 T1w volume’s orientation is indicated by header<code class="language-plaintext highlighter-rouge">['qform_code'] == 1</code>. And, the volume file name with ‘echo’ means it is 2D, which is not valid. Collect all paths in a file, where each line is one T1w of a subject.</li> <li>At least one functional MRI volume (4D) at rest state or any task. There might be multiple sessions and runs of fMRI scans for each subject. The pipeline requires the fMRI in one <code class="language-plaintext highlighter-rouge">subject</code> to have the same shape. So, you need to check the <code class="language-plaintext highlighter-rouge">header['dim']</code> of each fMRI to be the same. Otherwise, let it be a new <code class="language-plaintext highlighter-rouge">subject</code> with corresponding T1w volume. After data paths of T1w and fMRI are collected, you need to make sure how many fMRI sessions are matched to one T1w volume. And save those numbers.</li> <li>Any atlas label volume (3D) in the MNI space, along with the look-up table. Raw atlas files vary and depend on publishers. They might be in the surface format, if so, you need to convert it to volume first. Then, let the original label ID of the atlas volume remap to <code class="language-plaintext highlighter-rouge">[1, N]</code>, where N is the number of RoI. Along with the remapped atlas, the label name needs to be generated into a Txt file as the template in CONN toolbox.</li> </ol> <h2 id="ii-conn-step-1">II. CONN step #1</h2> <ol> <li>Load the path of T1w, fMRI, and RoI: Copy path of subjects into CONN toolbox</li> <li>Click preprocessing: Registration, segmentation</li> <li>Click Done: Extract RoI</li> </ol> <h2 id="iii-conn-step-2">III. CONN step #2</h2> <ol> <li>Choose all RoIs in the list: Set all RoIs for the following process</li> <li> <p>Click Done: Regression RoIs</p> </li> <li>Check output: We are done with CONN toolbox part. Go to the output directory and check this path.</li> </ol> <h2 id="iv-get-the-output">IV. Get the output</h2> <p>BOLD timeseries are saved in <code class="language-plaintext highlighter-rouge">.mat</code> files.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/kerberos-unc/">Ubuntu 20.04 LTS configuring Kerberos client with PAM</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/nnplot/">Visualize your NN to see which channels are important</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Ziquan Wei. <details><summary>Since 2024. Click to see page views. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>.</summary><div style="float: center"><script type="text/javascript" id="mapmyvisitors" src="https://mapmyvisitors.com/map.js?cl=080808&amp;w=200&amp;t=tt&amp;d=iQqJzCTKcRumFQOuhUBlR2HaCf7nKbyuOLrZ87uhBG8&amp;co=ffffff&amp;cmo=3acc3a&amp;cmn=ff5353&amp;ct=808080"></script></div></details> </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script>for(var wechatModal=document.getElementById("WeChatMod"),wechatBtn=document.querySelectorAll('[id="WeChatBtn"]'),i=0;i<wechatBtn.length;i++)wechatBtn[i].onclick=function(){wechatModal.style.display="block"};window.onclick=function(t){t.target==wechatModal&&(wechatModal.style.display="none")};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> </body> </html>